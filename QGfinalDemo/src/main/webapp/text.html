<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>图片操作</title>
    <script src="src/js/vue.js"></script>
</head>
<body>
<div id="app">
    <h2>图片操作</h2>
    <input type="file" @change="prepareUpload" ref="fileInput" accept="image/*">
    <button @click="uploadFile">上传图片</button>
    <p>上传的图片名：{{ fileName }}</p>
</div>

<script>
    new Vue({
        el: '#app',
        data: {
            fileName: "", // 用于存储图片名
            fileData: null // 用于存储图片数据
        },
        methods: {
            // 准备图片上传
            prepareUpload(event) {
                this.fileData = event.target.files[0];
                this.fileName = this.fileData.name;
            },
            // 图片上传
            uploadFile() {
                let LoadHttp;
                if (window.XMLHttpRequest) {
                    LoadHttp = new XMLHttpRequest();
                } else {
                    LoadHttp = new ActiveXObject("Microsoft.XMLHTTP");
                }
                LoadHttp.open("POST", "http://localhost:8080/QGfinalDemo_war/File");
                let formData = new FormData();
                formData.append("method", "upload");
                formData.append("file", this.fileData);
                LoadHttp.send(formData);
                LoadHttp.onreadystatechange = (event) => {
                    if (event.target.readyState === 4 && event.target.status === 200) {
                        const message = event.target.responseText.split(":", 2);
                        const type = message[0];
                        const content = message[1];
                        if(type==='error'){
                            alert("1");
                        }else if(type==='url'){
                            alert("2");
                        }else{
                            alert("3");
                        }
                        alert(event.target.responseText);
                    }
                };
            },
        }
    });
</script>
</body>
</html>